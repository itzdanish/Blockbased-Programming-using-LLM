<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Blocky</title>
    <!-- Font Awesome icons (free version)-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Google fonts-->

    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <link href="css/coursecreator.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-auth.js"></script>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional

        var firebaseConfig = {
            apiKey: "AIzaSyBTNIg29kbCt-GhFenHNZa34Xkl8M4k8cw",
            authDomain: "block-5acdc.firebaseapp.com",
            projectId: "block-5acdc",
            storageBucket: "block-5acdc.appspot.com",
            messagingSenderId: "57460143611",
            appId: "1:57460143611:web:3efd4e65ab5898b59fc75e",
            measurementId: "G-31XZGSV3WT"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();


        var db = firebase.firestore();
    </script>





</head>

<body>
    <!-- Navbar -->    
  <nav class="navbar navbar-expand-lg navbar-light bg-dark " id="navbar-home">
    <a class="navbar-brand" href="dashboard_teach.html"><i class="fa fa-home fa-2x" id="home"></i></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ml-auto" id="nav-list">        
        <li class="nav-item active">
          <button type="button" class="btn-sm btn btn-primary mr-sm-1"><a class="nav-link" id="nav_text" href="teach_my_projects.html">My
              Projects</a></button>
        </li>       
        <li>
          <img src="assets/prof.jpeg" alt="" height="45px" width="45px">
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id="nav_text" href="#" id="navbarDropdownMenuLink" role="button"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
            <a class="dropdown-item" href="my_profile.html">My Profile</a>            
            <a class="dropdown-item" href="course_list.html">View Courses</a>
            <a class="dropdown-item" id="signOut" onclick="signOut()">Logout</a>
          </div>
        </li>

    </div>

    </ul>
    </div>
  </nav>


    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-9 mx-auto" id="rectangle1">
                <div class="row">
                    <div class="col-8 ml-sm-4">
                        <h1>Course Creator</h1>
                    </div>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-9 mx-auto" id="rectangle">
                <div>

                    <div class="form-group mt-md-3">
                        <label>Course Title</label>
                        <input type="text" class="form-control" id="course_title" placeholder="">
                    </div>
                    <div class="form-group">
                        <label>Course Description</label>
                        <textarea class="form-control" id="course_discription" rows="3"></textarea>
                    </div>
                    <div class="line">
                    </div>
                    <div class="form-inline mt-md-3">
                        <button type="button" id="save" onclick="createCourse()"
                            class="btn btn-secondary btn-lg col-sm-5 mx-auto">Save Course</button>                        
                    </div><br>
                    <div class="line">
                    </div>
                </div>

            </div>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Create Lesson</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="dropdown mt-md-3">
                        <!-- <button class="btn btn-secondary dropdown-toggle col-sm-12 " type="button" id="select_ct"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select Course
                        </button> -->
                        <!-- <div id="drop" class="dropdown-menu col-sm-12" aria-labelledby="dropdownMenuButton"> -->
                            <!-- <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <a class="dropdown-item" href="#">Something else here</a> -->
                        <!-- </div> -->

                        <select id="drop" class="form-select btn btn-secondary dropdown-toggle col-sm-12 " aria-label="Default select example">
                            <option selected>Select course name</option>
                            <!-- <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option> -->
                          </select>
                    </div>
                    <div class="form-group mt-md-3">
                        <label>Lesson Title</label>
                        <input type="text" class="form-control" id="lesson_title" placeholder="">
                    </div>
                    <div class="form-group">
                        <label>Lesson Description</label>
                        <textarea class="form-control" id="lesson_discription" rows="3"></textarea>
                    </div>
                    <div class="form-group mt-md-3">
                        <label>Video Link</label>
                        <input type="text" class="form-control" id="lesson_link" placeholder="">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" onclick="createLesson()" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>



    <br>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>



    <script>
        const characters ='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';

var email = "";
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in.
    email=user.email;
         // display courses in dropdown start

         db.collection("teachers").doc(email).collection("course")
            .onSnapshot(querySnapshot=>{
                    querySnapshot.forEach(doc=>{
                        let data = doc.data();
                        let row  = `<option value="${data.course_title}">${data.course_title}</option>`;

                        let droplist = document.getElementById('drop')
                        droplist.innerHTML += row
                    })
                })
                .catch(err=>{
                    console.log(`Error: ${err}`)
                });


        //display courses in dropdown end
  } else {
    // No user is signed in.
    window.location.href="login.html"
  }
});



   

        function createCourse() {
            var course_title = document.getElementById('course_title').value;
            var course_discription = document.getElementById('course_discription').value;
            var docRef = db.collection("teachers").doc(email);      
        
            docRef.get().then((doc) => {
                  if (doc.exists) {
                    console.log("Document data:", doc.data());
                    var teacher_name = doc.data().name;
                    var id = firebase.auth().currentUser.uid;
            db.collection('teachers').doc(email).collection('course').doc(course_title).set({
                course_title: course_title,
                course_discription: course_discription, 
                teacher_name: teacher_name,
                course_code: generateString()
            }).then(()=>{
                window.location.href="course_list.html"
            })
            
                  } else {
                    // doc.data() will be undefined in this case
                    console.log("No such document!");
                  }
                }).catch((error) => {
                  console.log("Error getting document:", error);
                });

            
            
        }

        function createLesson() {
        
            var lesson_title = document.getElementById('lesson_title').value;
            var lesson_discription = document.getElementById('lesson_discription').value;
            var lesson_link = document.getElementById('lesson_link').value;
            var select_ct = document.getElementById('drop').value;

            var id = firebase.auth().currentUser.uid;
            db.collection('teachers').doc(email).collection('course').doc(select_ct).collection('lessons').doc(lesson_title).set({
                lesson_title: lesson_title,
                lesson_discription: lesson_discription,
                lesson_link: lesson_link,
            }).then(()=>{
                window.location.href="course_list.html"
            })
            $('#exampleModal').modal('hide');
        }
//         function generateString() {
//     let result = '';
//     const charactersLength = 6;
//     for ( let i = 0; i < 6; i++ ) {
//         result += characters.charAt(Math.floor(Math.random() * charactersLength));
//     }

//     return result;
// }
function generateString() {
    let result = '';
    const charactersLength = characters.length;
    for ( let i = 0; i < 6; i++ ) {
        result += characters.charAt(Math.floor(Math.random() * charactersLength));
    }

    return result;
}
        
        function signOut() {
                  firebase.auth().signOut();
                  window.location.replace('login.html');
                }
                               
       
    </script>
</body>