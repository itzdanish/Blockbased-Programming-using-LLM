<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>My Projects</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="stylesheet" href="css/my_projects.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.1/js/all.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>

        <!-- Firebase -->
        <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-auth.js"></script>
        
        <script>
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
         
            var firebaseConfig = {
                apiKey: "AIzaSyBTNIg29kbCt-GhFenHNZa34Xkl8M4k8cw",
                authDomain: "block-5acdc.firebaseapp.com",
                projectId: "block-5acdc",
                storageBucket: "block-5acdc.appspot.com",
                messagingSenderId: "57460143611",
                appId: "1:57460143611:web:3efd4e65ab5898b59fc75e",
                measurementId: "G-31XZGSV3WT"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            firebase.analytics();

          
            var db = firebase.firestore();
          </script>
    </head>
    <body>
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-dark " id="navbar-home">
          <a class="navbar-brand" href="dashboard_stud.html"><i class="fa fa-home fa-2x" id="home"></i></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto" id="nav-list">
              
              <li class="nav-item active">
                <button type="button" class="btn-sm btn btn-primary mr-sm-1"><a class="nav-link" id="nav_text" href="stud_my_projects.html">My
                    Projects</a></button>
              </li>
              <li class="nav-item active">
                <button type="button" class="btn-sm btn btn-primary mr-sm-1"><a class="nav-link" id="nav_text"
                    href="stud_courselist.html">Enroll a course</a></button>
              </li>
              <li>
                <img src="assets/prof.jpeg" alt="" height="45px" width="45px">
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="nav_text" href="#" id="navbarDropdownMenuLink" role="button"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="my_profile.html">My Profile</a>            
                  <a class="dropdown-item" href="stud_courselist.html">View Courses</a>
                  <a class="dropdown-item" id="signOut" onclick="signOut()">Logout</a>
                </div>
              </li>
      
          </div>
      
          </ul>
          </div>
        </nav>
          <!-- Navbar end -->
          <!-- createModal start-->
          <div class="modal" tabindex="-1" role="dialog" id="createModal">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Create Project</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p>Enter Project Title: </p>
                  <input type="text"  id="projectTitle" placeholder="Title">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-primary" onclick="createFunction()">Save changes</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
          <!-- createModal end -->
          <!-- courses list row 1  -->
          <div class="container"> 
            <div class="row">
              <div class="col-sm">
                <br><h1>My Projects</h1>
              </div>
              <nav class="navbar navbar-light">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createModal">Create</button>&nbsp;
                <br>
              </nav>
            </div>
            </div>
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <table class="table table-bordered" id="projectTable">
                        <thead>
                          <tr>                            
                            <th scope="col">Name</th>
                            <th scope="col"></th>
                          </tr>
                        </thead>
                        <tbody>
                          <!-- <tr>                            
                            <td>Project_title</td>
                            <td><button type="button" class="btn btn-primary">View</button>
                            </td>
                          </tr>
                          <tr>                            
                            <td>Project_title</td>
                            <td><button type="button" class="btn btn-primary">View</button>
                            </td>
                          </tr>
                          <tr>                            
                            <td>Project_title</td>
                            <td><button type="button" class="btn btn-primary">View</button>
                            </td>
                          </tr> -->
                        </tbody>
                      </table>
                
                </div>
               
            </div>
        </div>
        <script>
          var email="";

          firebase.auth().onAuthStateChanged(function(user) {
                  if (user) {
                    // User is signed in.
                    email=user.email;
                     // Display Projects List
            db.collection("students").doc(email).collection("MyProjects")
            .get()
            .then(querySnapshot=>{
                    querySnapshot.forEach(doc=>{
                        let data = doc.data();
                        let row  = `<tr>
                                        <td>${data.title}</td>
                                  <td><button type="button" id="${data.title}" class="btn btn-primary" onclick="goToBlockly(this.id)">View</button></td>
                                      
                                  </tr>`;

                        let table = document.getElementById('projectTable')
                        table.innerHTML += row
                    })
                })
                .catch(err=>{
                    console.log(`Error: ${err}`)
                });


                  } else {
                    // No user is signed in.
                    // alert("Error occuered. Please try again!!!");
                    window.location.href="login.html";
                    
                  }
                });


         

         //goToBlockly()

         function goToBlockly(project_title)
         {
           sessionStorage.setItem("project_title",project_title);
          console.log(project_title);
           window.location.href="blockly/Main Project/public/public/blockly/demos/code - Copy/index1.html";
         } 
          
          
          // Create project
          function createFunction()
          {
            
            var projectTitlex=document.getElementById("projectTitle").value;

            var docRef = db.collection("AllProjects").doc(projectTitlex);

              docRef.get().then((doc) => {
                  if (doc.exists) {
                      console.log("Document data:", doc.data());
                      Swal.fire({
                    icon: 'error',
                    title: 'Project Already Exists!!!',
                    
                  
                  }).then(()=>{
                    $('#createModal').modal('hide');

                  })
                  } else {
                      // doc.data() will be undefined in this case
                      console.log("No such document!");
                      db.collection("students").doc(email).collection("MyProjects").doc().set({
                      title: document.getElementById("projectTitle").value,
                  })
                  .then(() => {
                      console.log("Document successfully written!");
                  })
                  .catch((error) => {
                      console.error("Error writing document: ", error);
                  });


                  db.collection("AllProjects").doc(projectTitlex).set({
                      title: document.getElementById("projectTitle").value,
                  })
                  .then(() => {
                      console.log("Document successfully written!");
                  })
                  .catch((error) => {
                      console.error("Error writing document: ", error);
                  });

                  $('#createModal').modal('hide');
                  Swal.fire({
                    icon: 'success',
                    title: 'Project Added Successfully',
                    
                  
                  }).then(()=>{
                    window.location.reload();

                  })
                  }
              }).catch((error) => {
                  console.log("Error getting document:", error);
              });

                
              
                  
            
    

          }


          function signOut(){
                  firebase.auth().signOut().then(()=>{
                    window.location.href='login.html';
                  });
                }
        </script>

          <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    </body>
</html>


          