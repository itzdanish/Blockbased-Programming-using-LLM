<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Blockly â€” Login</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body { background: #f4f6f8; font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
      .card-auth { max-width: 480px; margin: 40px auto; border-radius: 12px; box-shadow: 0 6px 18px rgba(20,30,50,0.08); }
      .google-btn { background:#fff; border:1px solid #e3e6ea; color:#202124; }
      .google-logo { height:18px; width:18px; margin-right:10px; }
      .btn-primary { background: #1a73e8; border-color: #1a73e8; }
      .role-select { width: 160px; }
    </style>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-firestore.js"></script>
  </head>

  <body>

    <div class="card card-auth p-4">
      <div class="card-body">
        <h3 class="card-title text-center mb-3">Welcome back</h3>
        <p class="text-center text-muted mb-4">Sign in to continue to Blocky LMS</p>

        <div class="d-flex justify-content-end mb-2">
          <select id="loginRole" class="form-select role-select form-select-sm">
            <option value="Student" selected>Student</option>
            <option value="Teacher">Teacher</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label small">Email</label>
          <input id="loginEmail" type="email" class="form-control form-control-lg" placeholder="you@example.com">
        </div>

        <div class="mb-1">
          <label class="form-label small">Password</label>
          <input id="loginPassword" type="password" class="form-control form-control-lg" placeholder="Enter password">
        </div>

        <div class="text-end mb-3">
          <a href="#" id="forgotPasswordLink" class="small">Forgot password?</a>
        </div>

        <div class="d-grid gap-2 mb-3">
          <button id="btnEmailLogin" class="btn btn-primary btn-lg">Sign in</button>
        </div>

        <div class="text-center text-muted mb-3">or</div>

        <div class="d-grid mb-3">
          <button id="googleSignInBtn" class="btn google-btn btn-lg">
            <img class="google-logo"
              src="data:image/svg+xml;utf8,
              <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'>
                <path fill='%23EA4335' d='M24 9.5c3.94 0 7.17 1.35 9.34 3.14l7-6.86C36.56 2.87 30.7 0 24 0 14.62 0 6.99 5.2 2.98 12.84l8.12 6.3C13.66 13.2 18.38 9.5 24 9.5z'/>
                <path fill='%234285F4' d='M46.45 24.5c0-1.6-.14-2.8-.44-4.03H24v8.06h12.8c-.55 3.02-2.35 5.6-5.02 7.34l7.66 5.92C42.78 38.4 46.45 32.78 46.45 24.5z'/>
                <path fill='%23FBBC05' d='M10.99 29.14A14.9 14.9 0 0 1 9.5 24.5c0-1.65.3-3.24.86-4.7L2.24 13.5C.82 16.29 0 19.33 0 24.5c0 5.24.82 8.99 2.24 11.99l8.75-6.35z'/>
                <path fill='%2341B169' d='M24 48c6.7 0 12.56-2.22 16.8-6.03l-7.66-5.92C31.2 36.6 27.98 38 24 38c-5.62 0-10.34-3.7-12.68-8.84L2.98 36.84C6 44.8 14.62 48 24 48z'/>
              </svg>" />
            Sign in with Google
          </button>
        </div>

        <div class="text-center small text-muted">
          Don't have an account?
          <a href="#" id="createAccountLink">Create account</a>
        </div>
      </div>
    </div>

    <div class="modal fade" id="resetModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content p-2">
          <div class="modal-header">
            <h5 class="modal-title">Reset Password</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <label class="form-label small">Enter your email</label>
            <input id="resetEmail" type="email" class="form-control" placeholder="you@example.com">
            <div id="resetMessage" class="mt-2 small"></div>
          </div>
          <div class="modal-footer">
            <button id="resetSubmit" class="btn btn-primary">Send reset link</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


    <script src="firebase-auth.js"></script>

    <script>
      // PASSWORD RESET POPUP
      const resetModal = new bootstrap.Modal(document.getElementById("resetModal"));

      document.getElementById('forgotPasswordLink').addEventListener('click', function (e) {
        e.preventDefault();
        resetModal.show();
      });

      document.getElementById("resetSubmit").addEventListener("click", function () {
        const email = document.getElementById("resetEmail").value.trim();
        const msg = document.getElementById("resetMessage");

        msg.innerHTML = "";

        if (!email) {
          msg.innerHTML = "<span class='text-danger'>Please enter an email.</span>";
          return;
        }

        firebase.auth().fetchSignInMethodsForEmail(email)
          .then((methods) => {
            if (methods.length === 0) {
              msg.innerHTML = "<span class='text-danger'>This email is not registered.</span>";
              return;
            }

            return firebase.auth().sendPasswordResetEmail(email)
              .then(() => {
                msg.innerHTML = "<span class='text-success'>Reset link sent! Check your inbox.</span>";
              });
          })
          .catch((err) => {
            msg.innerHTML = "<span class='text-danger'>" + err.message + "</span>";
          });
      });



      // Emial and  Password login
      document.getElementById("btnEmailLogin").addEventListener("click", function () {
        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value.trim();
        const role = document.getElementById("loginRole").value;

        if (!email) {
          alert("Please enter an email.");
          return;
        }
        if (!password) {
          alert("Please enter a password.");
          return;
        }

        firebase.auth().signInWithEmailAndPassword(email, password)
          .then((userCredential) => {
            // Logged in successfully
            if (role === "Student") {
              window.location.href = "dashboard_stud.html";
            } else {
              window.location.href = "dashboard_teach.html";
            }
          })
          .catch((err) => {
            alert("Login failed: " + err.message);
          });
      });


      //Google login
      document.getElementById('googleSignInBtn').addEventListener('click', function () {
        const role = document.getElementById('loginRole').value;
        window.FirebaseAuthApp.signInWithGoogle(role);
      });


      //create account option
      document.getElementById('createAccountLink').addEventListener('click', function (e) {
        e.preventDefault();
        const role = document.getElementById('loginRole').value;
        window.location.href = role === "Student" ? "signupStudent.html" : "signupTeacher.html";
      });

    </script>

  </body>
</html>
